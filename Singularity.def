Bootstrap: docker
From: ubuntu:22.04

%post
    # Basic setup
    export DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get install -y \
        build-essential \
        wget \
        python3-pip \
        python3-venv \
        curl

    # Install BLAST+
    cd /opt
    wget https://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/ncbi-blast-2.17.0+-x64-linux.tar.gz
    tar -zxf ncbi-blast-2.17.0+-x64-linux.tar.gz
    rm ncbi-blast-2.17.0+-x64-linux.tar.gz

    # Install uv to a known location
    curl -LsSf https://astral.sh/uv/install.sh | sh
    export PATH="/root/.local/bin:$PATH"

    # Create venv and install packages
    /root/.local/bin/uv venv --python 3.12 /opt/venv
    /opt/venv/bin/uv pip install \
        black \
        polars \
        pyarrow \
        pyfastx \
        ruff

%environment
    export PATH="/opt/ncbi-blast-2.17.0+/bin:/opt/venv/bin:$PATH"